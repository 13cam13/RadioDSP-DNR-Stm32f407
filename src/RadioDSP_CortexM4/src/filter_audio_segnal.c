/**
  ******************************************************************************
  * @file    filter_audio_segnal.c
  * @author  Giuseppe Callipo - IK8YFW - ik8yfw@libero.it
  * @version V2.0.0
  * @date    25-09-2018
  * @brief   IO Routine
  *
  *
  * NOTE: This file is part of RadioDSP project.
  *       See main.c file for additional project informations.
  * Platform: CortexM4
  ******************************************************************************/

#include "stm32f4xx_conf.h"
#include "filter_audio_segnal.h"
/*  Calculator used: https://www.arc.id.au/FilterDesign.html */

//WIDE FIR 16khz LPF (passthrough)
const float32_t firCoeffs32_3[NUM_TAPS_3] = {
0.000803,
-0.002771,
0.002753,
0.005922,
-0.030437,
0.072367,
-0.123064,
0.165313,
0.818182,
0.165313,
-0.123064,
0.072367,
-0.030437,
0.005922,
0.002753,
-0.002771,
0.000803};

//LARGE FIR > 6khz LPF

const float32_t firCoeffs32_4[NUM_TAPS_4] = {
0.000738,
-0.001982,
-0.007386,
0.015886,
0.021774,
-0.066504,
-0.038116,
0.302661,
0.545455,
0.302661,
-0.038116,
-0.066504,
0.021774,
0.015886,
-0.007386,
-0.001982,
0.000738};


// MEDIUM FIR 3.5 khz lpf
const float32_t firCoeffs32[NUM_TAPS] = {-0.000400,
0.000035,
0.002694,
0.006432,
0.005821,
-0.005180,
-0.024551,
-0.036263,
-0.016296,
0.049204,
0.146726,
0.235915,
0.272109,
0.235915,
0.146726,
0.049204,
-0.016296,
-0.036263,
-0.024551,
-0.005180,
0.005821,
0.006432,
0.002694,
0.000035,
-0.000400
};

// LPF CW narrow 500 Hz
const float32_t firCoeffs32_2[NUM_TAPS_2] ={0.000019,
0.000022,
0.000006,
-0.000044,
-0.000143,
-0.000302,
-0.000533,
-0.000836,
-0.001207,
-0.001629,
-0.002077,
-0.002515,
-0.002903,
-0.003194,
-0.003347,
-0.003329,
-0.003119,
-0.002720,
-0.002159,
-0.001487,
-0.000786,
-0.000158,
0.000276,
0.000392,
0.000071,
-0.000786,
-0.002243,
-0.004316,
-0.006962,
-0.010074,
-0.013478,
-0.016941,
-0.020175,
-0.022864,
-0.024678,
-0.025303,
-0.024464,
-0.021957,
-0.017667,
-0.011589,
-0.003837,
0.005353,
0.015633,
0.026557,
0.037607,
0.048227,
0.057858,
0.065977,
0.072130,
0.075968,
0.077273,
0.075968,
0.072130,
0.065977,
0.057858,
0.048227,
0.037607,
0.026557,
0.015633,
0.005353,
-0.003837,
-0.011589,
-0.017667,
-0.021957,
-0.024464,
-0.025303,
-0.024678,
-0.022864,
-0.020175,
-0.016941,
-0.013478,
-0.010074,
-0.006962,
-0.004316,
-0.002243,
-0.000786,
0.000071,
0.000392,
0.000276,
-0.000158,
-0.000786,
-0.001487,
-0.002159,
-0.002720,
-0.003119,
-0.003329,
-0.003347,
-0.003194,
-0.002903,
-0.002515,
-0.002077,
-0.001629,
-0.001207,
-0.000836,
-0.000533,
-0.000302,
-0.000143,
-0.000044,
0.000006,
0.000022,
0.000019
};
//

#ifdef EXP_SMOOTING
// Variable noise filter (Exponential Smooting Moving Filter) : n: 3 (max) - 1 (min)
void smootingFilter(float* smotStatusBuffer, float* bufferIn, float* bufferOut, uint8_t n,int blockSize){

    float coeff;
    if (n==1) coeff = 0.8;
	if (n==2) coeff = 0.7;
	if (n==3) coeff = 0.6;
	if (n==4) coeff = 0.5;
	if (n==5) coeff = 0.3;
	if (n==6) coeff = 0.1;

    for (int i = 0; i<blockSize; i++){
     smotStatusBuffer[i]+= (bufferIn[i] - smotStatusBuffer[i]) * coeff;
     bufferOut[i]= smotStatusBuffer[i];
    }
}
#endif

/**************************************END OF FILE****/
